include:
  - project: 'stream-machine/tools-and-utilities/ci-templates'
    file: '/nodejs/publish.yml'

generate-typescript:
  stage: generate
  image: namely/protoc-all:latest
  before_script:
    - apt-get install -y make unzip
    # Ensure that the protoc compiler has the Google protos
    - make default-google-dependencies
  script:
    - make generate-typescript
  artifacts:
    paths:
      - lang/typescript
  except:
    - master

typescript-artifact-snapshot:
  stage: publish
  extends: .nodejs-artifact-snapshot
  dependencies:
    - generate-typescript
  needs:
    - generate-typescript
  script:
    - make publish-typescript-snapshot

typescript-artifact-release:
  stage: publish
  extends: .nodejs-artifact-release
  dependencies:
    - generate-typescript
  needs:
    - generate-typescript
  script:
    - make publish-typescript-release
